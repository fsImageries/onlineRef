var le=Object.defineProperty,de=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var H=(t,e,n)=>e in t?le(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,g=(t,e)=>{for(var n in e||(e={}))B.call(e,n)&&H(t,n,e[n]);if(N)for(var n of N(e))z.call(e,n)&&H(t,n,e[n]);return t},y=(t,e)=>de(t,ue(e));var I=(t,e)=>{var n={};for(var s in t)B.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&N)for(var s of N(t))e.indexOf(s)<0&&z.call(t,s)&&(n[s]=t[s]);return n};import{j as T,r as h,I as K,g as R,R as fe,$ as S,G as ge,L as j,K as he,a as E,v as pe,S as me,b as ye,T as xe,c as ve,d as we}from"./vendor.7a410709.js";const Ce=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}};Ce();var Re="./assets/bg_scatter2.9c098e5a.svg",Se="./assets/end.1bc3b220.svg";const c=T.exports.jsx,w=T.exports.jsxs,X=T.exports.Fragment,ke=({imageProps:t,onChange:e,idx:n})=>{const s=h.exports.useRef(),r=o=>{const i=s.current,l=i.scaleX(),a=i.scaleY();i.scaleX(1),i.scaleY(1),e(y(g({},t),{src:t.src,x:i.x(),y:i.y(),width:Math.max(5,i.width()*l),height:Math.max(i.height()*a)}))};return c(X,{children:c(K,y(g({},t),{draggable:!0,name:"image",ref:s,onMouseOver:()=>{t.type==="vid"&&setPlaying({type:"play"})},onMouseLeave:()=>{t.type==="vid"&&setPlaying({type:"pause"})},onDragMove:o=>{e(y(g({},t),{x:o.target.x(),y:o.target.y()}))},onDragEnd:o=>{e(y(g({},t),{x:o.target.x(),y:o.target.y()}))},onTransformEnd:r}))})},be=({props:t,isPlaying:e,setPlaying:n})=>{const s=h.exports.useRef(),r=t.height/100*5,o=r/2,i=()=>{n({type:e?"pause":"play"})},l=()=>{if(e){const a=3,u=r,m=p=>1/Math.sin(p),d=1/2*u*m(Math.PI/a);return c(fe,{ref:s,x:t.x+t.width/2,y:t.y+t.height-u/2-o,rotation:90,sides:a,radius:d,fill:S(":root").css("--btn-fill"),opacity:0,onClick:i})}else{const a=t.x+t.width/2,u=t.y+t.height-o,m=r/10*2,d=[0,1].map(p=>{const x=p===0?a-m:a+m;return[x,u,x,u-r]});return c(ge,{ref:s,opacity:0,onClick:i,children:d.map((p,x)=>c(j,{points:p,stroke:S(":root").css("--btn-fill"),strokeWidth:r/10},x))})}};return h.exports.useLayoutEffect(()=>{const a=1.5,u=new R.timeline;u.to(s.current,{onComplete:()=>u.reverse(),duration:a,opacity:.35,ease:"power2.inOut"})},[e]),l()},Me=(t,e)=>{switch(e.type){case"pause":return e.video.pause(),!1;case"play":return e.video.play(),!0}},_e=({imageProps:t,onChange:e,idx:n})=>{const s=h.exports.useRef();h.exports.useEffect(()=>{t.image.play();const a=s.current.getLayer(),u=new he.Animation(()=>{},a);return u.start(),t.image.pause(),()=>u.stop()},[t.image]);const[r,o]=h.exports.useReducer(Me,!1),i=a=>{a=y(g({},a),{video:t.image}),o(a)},l=a=>{const u=s.current,m=u.scaleX(),d=u.scaleY();u.scaleX(1),u.scaleY(1),e(y(g({},t),{src:t.src,x:u.x(),y:u.y(),width:Math.max(5,u.width()*m),height:Math.max(u.height()*d)}))};return w(X,{children:[c(K,y(g({},t),{draggable:!0,name:"image",ref:s,onMouseOver:()=>i({type:"play"}),onMouseLeave:()=>i({type:"pause"}),onDragMove:a=>{e(y(g({},t),{x:a.target.x(),y:a.target.y()}))},onDragEnd:a=>{e(y(g({},t),{x:a.target.x(),y:a.target.y()}))},onTransformEnd:l})),c(be,{props:t,isPlaying:r,setPlaying:i})]})},$=({icon:t,onClick:e,reference:n,className:s,toolTip:r})=>c("div",{ref:n,title:r&&r,className:`toolItem ${s}`,onClick:e,children:c("i",{className:t})}),Ee=t=>{var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:null},Le=(t=null)=>{const e=JSON.parse(localStorage.getItem("settings"));return e!==void 0?t!==null?e[t]:e:null},De=t=>{const e=JSON.stringify(t);localStorage.setItem("settings",e)},Ne=(t,e,n="text/plain")=>{let s=document.createElement("a"),r=new Blob([t],{type:n});s.href=URL.createObjectURL(r),s.download=e,s.click()},Ge=t=>new Promise((e,n)=>{const s=new FileReader;s.readAsText(t),s.onerror=n,s.onload=()=>e(JSON.parse(s.result))}),Ie=t=>t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>2,_=t=>{const[e,n]=h.exports.useState(t),s=h.exports.useRef(e);return[s,o=>{s.current=o,n(o)}]};class Te{constructor(e=null){e===null&&(e={stageDrag:!1,isGuides:!1,isResize:!1,isRot:!1,rotateFree:!1,scaleBy:1.015});const[n,s]=_(e);this._states=n,this.setStates=s}get states(){return this._states.current}get stageDrag(){return this.states.stageDrag}get isGuides(){return this.states.isGuides}get isResize(){return this.states.isResize}get isRot(){return this.states.isRot}get rotateFree(){return this.states.rotateFree}get scaleBy(){return this.states.scaleBy}setStageDrag(e){this.setStates(y(g({},this.states),{stageDrag:e}))}setGuides(e){this.setStates(y(g({},this.states),{isGuides:e}))}setResize(e){this.setStates(y(g({},this.states),{isResize:e,isRot:e?!1:this.states.isRot}))}setRot(e){this.setStates(y(g({},this.states),{isRot:e,isResize:e?!1:this.states.isResize}))}setRotateFree(e){this.setStates(y(g({},this.states),{rotateFree:e}))}setScaleBy(e){this.setStates(y(g({},this.states),{scaleBy:e?1.5:1.015}))}}const Y=E.createContext(),Oe=({value:t,children:e})=>c(Y.Provider,{value:t,children:e}),Pe=()=>h.exports.useContext(Y),Fe={visible:!1,x1:0,y1:0,x2:0,y2:0};class Ae{constructor(){const[e,n]=_(null),[s,r]=_([]);this._selectedId=e,this._nodesArray=s,this.selectShape=n,this.setNodes=r,this._stageRef=h.exports.useRef(),this._layerRef=h.exports.useRef(),this._trRef=h.exports.useRef(),this._selectionRectRef=h.exports.useRef(),this._curSelection=h.exports.useRef(g({},Fe))}get selectedId(){return this._selectedId.current}get nodesArray(){return this._nodesArray.current}get stageRef(){return this._stageRef.current}get layerRef(){return this._layerRef.current}get trRef(){return this._trRef.current}get selectionRectRef(){return this._selectionRectRef.current}get curSelection(){return this._curSelection.current}}const U=E.createContext(),Be=({value:t,children:e})=>c(U.Provider,{value:t,children:e}),ze=()=>h.exports.useContext(U),V={stageBg:S(":root").css("--bg-color2"),showGuides:!0};class He{constructor(e=null){if(e===null){const r=Le();e=r===null?g({},V):r}const[n,s]=_(e);this._settings=n,this.setSettings=s}get settings(){return this._settings.current}get stageBg(){return this.settings.stageBg}get showGuides(){return this.settings.showGuides}setStageBg(e){this.setSettings(y(g({},this.settings),{stageBg:e}))}setShowGuides(e){this.setSettings(y(g({},this.settings),{showGuides:e}))}reset(){this.setSettings(g({},V))}}const Z=E.createContext(),Ke=({value:t,children:e})=>c(Z.Provider,{value:t,children:e}),W=()=>h.exports.useContext(Z);class je{constructor(e=[]){const[n,s]=_(e);this._media=n,this.setMedia=s}get media(){return this._media.current}addMedia(e,n=!1){n?this.setMedia([...this.media,...e]):this.setMedia([...this.media,e])}}const J=E.createContext(),Xe=({value:t,children:e})=>c(J.Provider,{value:t,children:e}),q=()=>h.exports.useContext(J);class G{constructor(){this._controller=h.exports.useRef(this.getDefaults())}getDefaults(){return{anim:null}}get con(){return this._controller.current}}class $e extends G{getDefaults(){return{anim:null,_tl:null}}}class Ye extends G{getDefaults(){return{anim:null,svgTl:null,input:null,callback:null,setActive:null,isActive:null}}}class Ue extends G{getDefaults(){return{anim:null,right:null,left:null}}}const Q=E.createContext(),O=({value:t,children:e})=>c(Q.Provider,{value:t,children:e}),L=()=>h.exports.useContext(Q),Ve=(t,e)=>{const n=e.width/t.width,s=e.height/t.height;return Math.min(n,s)*.85},Ze=(t,e)=>{const s=t.height>e.height||t.width>e.width?Ve(t,e):1;return{width:t.width*s,height:t.height*s}},We=t=>new Promise((e,n)=>{let s=new Image;s.onload=()=>e(s),s.onerror=n,s.src=t}),Je=t=>new Promise((e,n)=>{let s=document.createElement("video");s.onloadedmetadata=()=>e(s),s.onerror=n,s.crossOrigin="anonymous",s.src=t,s.pause()}),D=async(t,e,n=null)=>{const s=nt(t);if(!s)return s;let r={src:t,x:0,y:0,width:0,height:0,type:s,id:pe()};if(s==="img"){const i=await We(t);r.width=i.width,r.height=i.height,r.image=i}else{const i=await Je(t);r.width=i.videoWidth,r.height=i.videoHeight,r.image=i}if(n===null&&(n={x:e.width/2,y:e.height/2,mid:!0}),r=g(g({},r),n),n.noMod)return r;const o=e;if((r.width>o.width||r.height>o.height)&&!n.width&&!n.height&&(r=g(g({},r),Ze(r,o))),n.mid){const i=r.x-r.width/2,l=r.y-r.height/2;r=y(g({},r),{x:(Math.max(i,0)-e.x)*e.scaleX,y:(Math.max(l,0)-e.y)*e.scaleY})}return r},qe=async(t,e,n)=>{const s=await ee(t);return D(s,e,n)},ee=t=>new Promise((e,n)=>{const s=new FileReader;s.readAsDataURL(t),s.onerror=n,s.onload=()=>e(s.result)}),Qe=async t=>{try{return await(await fetch(t,{method:"GET"})).blob()}catch{return null}},et=t=>{let e=document.createElement("div"),n=document.createRange();n.selectNodeContents(e);let s=n.createContextualFragment(t);e.appendChild(s);try{return e.firstElementChild.src}catch{return!1}},te=(t,e,n)=>Promise.all(Object.values(t).map(async s=>await qe(s,e,n))),P=async t=>{let e=await Qe(t);if(e)return ee(e);try{return new URL(t).href}catch{return!1}};//! should probably look up a real mime type solution
const tt="jpeg jpg png apng svg bmp",st="mp4 webm ogg 3gp",nt=t=>{let e=t.includes("image"),n=t.includes("video");if(!e&&!n){const s=t.split("."),r=s[s.length-1].toLowerCase();return tt.includes(r)?"img":st.includes(r)?"vid":!1}return e?"img":"vid"},rt=(t,e,n=null)=>{const s=e.map((u,m)=>{const x=u,{image:d}=x;return I(x,["image"])}),a=t,{width:r,height:o}=a;return{config:I(a,["width","height"]),media:s,settings:n}},ot=async(t,e,n,s)=>{const r=t.config,o=await Promise.all(t.media.map(async(i,l)=>(i=y(g({},i),{noMod:!0}),await D(i.src,r,i))));e.setConfig(g(g({},e.config),t.config)),s.setSettings(t.settings),n.setMedia(o)},it=(t,e,n)=>{const s=S(document.createElement("input"));return s.attr("type","file"),s.prop("multiple",!0),s.on("change",async()=>{const o=Array.from(s.prop("files")).filter((i,l)=>i.type.includes("json"));if(o.length){const i=await Ge(o[0]);console.log(i),e(i)}else{const i=await te(s.prop("files"),n);return t(i),i}}),s.trigger("click"),!1},se=(t,e,n,s,r,o)=>[()=>{},()=>{it(a=>{t.addMedia(a,!0)},a=>{ot(a,s,t,r)},s.config)},()=>{const i=JSON.stringify(rt(s.config,t.media,r.settings));Ne(i,"OnlineRef_Stage.json")},()=>{o.con.anim()},(i=!1)=>{n.nodesArray.forEach(l=>{l.attrs.type==="vid"&&i&&(Ie(l.attrs.image)?l.attrs.image.pause():l.attrs.image.play())})},()=>{e.setStageDrag(!e.stageDrag)},()=>{e.setGuides(!e.isGuides)},()=>{e.setResize(!e.isResize)},()=>{e.setRot(!e.isRot)},()=>{const i=n.nodesArray[0];if(i===void 0)return;const l=t.media.findIndex(a=>i.attrs.id===a.id);if(l>=0){const a=t.media.filter((u,m)=>m!==l);t.setMedia([...a,t.media[l]])}n.selectShape(null),n.trRef.nodes([]),n.setNodes([])},async()=>{const i=await Promise.all(n.nodesArray.map(async l=>{const a=t.media.filter(p=>p.id===l.attrs.id)[0],u=a.x-50,m=a.y-50;return await D(a.src,s.config,{x:u,y:m,width:a.width,height:a.height,noMod:!0})}));t.addMedia(i,!0)},()=>{const i=t.media.filter(l=>{let a=!0;for(let u=0;u<n.nodesArray.length;u++)n.nodesArray[u].attrs.id===l.id&&(a=!1);return a});t.setMedia(i),n.selectShape(null),n.trRef.nodes([]),n.setNodes([])}];var at="./assets/menu_bg.4a0d0d77.svg";const ct=(t,e)=>{switch(e){case!1:t.timeScale(1),t.play();break;case!0:t.timeScale(1.5),t.reverse();break}},lt="fas fa-sliders-h",dt=["fas fa-question","far fa-file-image","fas fa-file-download","fas fa-link","fas fa-play","fas fa-arrows-alt","fas fa-magnet","fas fa-expand-arrows-alt","fas fa-undo","fas fa-arrow-up"],ut=["Show a help menu with more extensive documentation.",`Import an image/video file or a stage config.
[CTRL+I]`,`Export and download a stage config.
[CTRL+S]`,`Import an image/video by link.
[I]`,`Play selected video(s).
[P]`,`Active stage drag/Deactive stage selection.
[D]`,`Toggle Guides/Snap.
[G]`,`Active resize/Deactive rotate on selected.
[T]`,`Active rotate/Deactive resize on selected.
[R]`,`Move selected image to foreground.
[M]`],ft=()=>{const[t,e]=h.exports.useState(!1),[n,s]=h.exports.useState(!1),r=h.exports.useRef(),o=h.exports.useRef(),i=h.exports.useRef(),l=h.exports.useRef(),a=R.utils.selector(i),u=Pe(),{link:m,menu:d}=L(),p=ze(),x=q(),k=W();m.con.callback=f=>{s(f)};const v=se(x,u,p,k,m),C=[,,,n,,u.stageDrag,u.isGuides,u.isResize,u.isRot],b=dt.map((f,M)=>[f,ut[M],v[M],C[M]]);return h.exports.useLayoutEffect(()=>{S(":root").css("--bg-menu",`url(${at})`);const f=R.timeline({duration:.1}),M={x:100,delay:-.6,stagger:.1};f.from(a(".toolItem:not(:nth-child(1))"),M),f.reverse(),l.current=f},[]),d.con.anim=()=>{const f=!t;e(f),ct(l.current,t),f||r.current.scroll({top:0,behavior:"smooth"})},c("div",{ref:r,className:`toolBarBg ${t?"":"hide"}`,onScroll:()=>{const f=S(".toolBar").css("backdrop-filter").includes("50")?49.99:50;S(".toolBar").css("backdrop-filter",`blur(${f}px)`)},children:w("div",{className:`toolBar ${t?"":"hide"}`,ref:i,children:[c($,{reference:o,icon:lt,onClick:()=>{d.con.anim()},className:`settingsAll ${t?"":"hide"}`}),b.map(([f,M,A,ie],ae)=>c($,{icon:f,className:ie&&"active",toolTip:M&&M,onClick:ce=>{A&&A(ce)}},ae))]})})},gt={position:"absolute",top:"0",right:"0"},ht={position:"absolute",bottom:"0",left:"0"},ne=({isRight:t})=>{const e=h.exports.useRef(),n=R.utils.selector(e),s=L();return h.exports.useLayoutEffect(()=>{const r=R.timeline({}),o={ease:"expo.out",x:t?500:-500,y:t?-500:500,stagger:.1};r.from(e.current,{zIndex:-1}),r.from(n(".slide"),o),r.pause(),s.con[t?"right":"left"]=r},[]),w("svg",{id:"visual",viewBox:"0 0 900 600",xmlns:"http://www.w3.org/2000/svg",version:"1.1",style:t?gt:ht,ref:e,children:[t&&w("g",{transform:"translate(900, 0)",children:[c("path",{className:"slide",className:"slide rightEnd",d:"M0 405.6C-44.5 403 -89 400.4 -124.2 382.3C-159.5 364.2 -185.6 330.7 -223.4 307.4C-261.2 284.2 -310.7 271.2 -328.2 238.4C-345.6 205.6 -331 153 -338.6 110C-346.1 67 -375.9 33.5 -405.6 0L0 0Z",fill:"#232745"}),c("path",{className:"slide rightMid2",d:"M0 304.2C-33.4 302.3 -66.7 300.3 -93.2 286.7C-119.6 273.2 -139.2 248 -167.5 230.6C-195.9 213.1 -233 203.4 -246.1 178.8C-259.2 154.2 -248.3 114.8 -253.9 82.5C-259.6 50.2 -281.9 25.1 -304.2 0L0 0Z",fill:"#96446e"}),c("path",{className:"slide rightMid1",d:"M0 202.8C-22.2 201.5 -44.5 200.2 -62.1 191.2C-79.7 182.1 -92.8 165.3 -111.7 153.7C-130.6 142.1 -155.3 135.6 -164.1 119.2C-172.8 102.8 -165.5 76.5 -169.3 55C-173.1 33.5 -187.9 16.7 -202.8 0L0 0Z",fill:"#f17c53"}),c("path",{className:"slide rightStart",d:"M0 101.4C-11.1 100.8 -22.2 100.1 -31.1 95.6C-39.9 91.1 -46.4 82.7 -55.8 76.9C-65.3 71 -77.7 67.8 -82 59.6C-86.4 51.4 -82.8 38.3 -84.6 27.5C-86.5 16.7 -94 8.4 -101.4 0L0 0Z",fill:"#fbae3c"})]}),!t&&w("g",{transform:"translate(0, 600)",children:[c("path",{className:"slide",d:"M0 -405.6C48.4 -409.6 96.7 -413.5 125.3 -385.8C154 -358.1 162.8 -298.7 197.5 -271.8C232.1 -244.9 292.6 -250.5 309.9 -225.1C327.1 -199.7 301.3 -143.4 310 -100.7C318.8 -58.1 362.2 -29 405.6 0L0 0Z",fill:"#232745"}),c("path",{className:"slide",d:"M0 -304.2C36.3 -307.2 72.5 -310.1 94 -289.3C115.5 -268.5 122.1 -224 148.1 -203.9C174.1 -183.7 219.4 -187.9 232.4 -168.8C245.4 -149.8 226 -107.6 232.5 -75.6C239.1 -43.5 271.7 -21.8 304.2 0L0 0Z",fill:"#96446e"}),c("path",{className:"slide",d:"M0 -202.8C24.2 -204.8 48.4 -206.7 62.7 -192.9C77 -179 81.4 -149.4 98.7 -135.9C116.1 -122.5 146.3 -125.3 154.9 -112.6C163.6 -99.9 150.6 -71.7 155 -50.4C159.4 -29 181.1 -14.5 202.8 0L0 0Z",fill:"#f17c53"}),c("path",{className:"slide",d:"M0 -101.4C12.1 -102.4 24.2 -103.4 31.3 -96.4C38.5 -89.5 40.7 -74.7 49.4 -68C58 -61.2 73.1 -62.6 77.5 -56.3C81.8 -49.9 75.3 -35.9 77.5 -25.2C79.7 -14.5 90.6 -7.3 101.4 0L0 0Z",fill:"#fbae3c"})]})]})},pt=()=>{const t=h.exports.useRef(),e=R.utils.selector(t),n=L();return h.exports.useLayoutEffect(()=>{const s=R.timeline({}),r={background:"rgba(10, 10, 20, 0)",backdropFilter:"blur(0px)"},o={duration:.2,opacity:0};s.from(t.current,r),s.from(e(".text"),o),s.pause(),n.con.zone=s,n.con.anim=(i=!1)=>{i?(n.con.left.reverse(),n.con.right.reverse(),n.con.zone.reverse()):(n.con.left.play(),n.con.right.play(),n.con.zone.play())}},[]),w("div",{className:"dropZone",ref:t,children:[c("div",{className:"text",children:"Just drop it in here."}),c(ne,{isRight:!0}),c(ne,{isRight:!1})]})},mt=()=>{const t=h.exports.useRef(),e=R.utils.selector(t),{link:n}=L();return h.exports.useLayoutEffect(()=>{const s=R.timeline({duration:1,paused:!0}),r={ease:"Expo.easeOut",scale:0,transformOrigin:"center",delay:-1,stagger:.1,zIndex:0};s.from(e(".slide"),r),n.con.svgTl=s},[]),c("svg",{ref:t,id:"visual",viewBox:"0 0 900 600",width:"900",height:"600",xmlns:"http://www.w3.org/2000/svg",className:"linkFieldSvg",children:w("g",{className:"innerParts",transform:"translate(427.76777625939775 273.13314100824914)",children:[c("g",{className:"slide",children:c("path",{d:"M72.5 -112.2C105 -106.8 149.9 -109.6 171.2 -92.3C192.6 -75 190.3 -37.5 186.7 -2.1C183.1 33.3 178.1 66.7 161.2 91.6C144.3 116.6 115.4 133.2 86.5 153.4C57.7 173.5 28.8 197.3 5 188.5C-18.8 179.8 -37.5 138.6 -59 114.2C-80.5 89.8 -104.8 82.1 -120.1 65.9C-135.4 49.7 -141.7 24.8 -143.8 -1.2C-146 -27.3 -144 -54.7 -131.7 -76C-119.4 -97.4 -96.7 -112.8 -73 -123.3C-49.3 -133.8 -24.7 -139.4 -2.3 -135.3C20 -131.3 40 -117.6 72.5 -112.2",fill:"#232745"})}),c("g",{className:"slide",transform:"scale(.75) rotate(5)",children:c("path",{d:"M72.5 -112.2C105 -106.8 149.9 -109.6 171.2 -92.3C192.6 -75 190.3 -37.5 186.7 -2.1C183.1 33.3 178.1 66.7 161.2 91.6C144.3 116.6 115.4 133.2 86.5 153.4C57.7 173.5 28.8 197.3 5 188.5C-18.8 179.8 -37.5 138.6 -59 114.2C-80.5 89.8 -104.8 82.1 -120.1 65.9C-135.4 49.7 -141.7 24.8 -143.8 -1.2C-146 -27.3 -144 -54.7 -131.7 -76C-119.4 -97.4 -96.7 -112.8 -73 -123.3C-49.3 -133.8 -24.7 -139.4 -2.3 -135.3C20 -131.3 40 -117.6 72.5 -112.2",fill:"#96446e"})}),c("g",{className:"slide",transform:"scale(.5), rotate(10)",children:c("path",{d:"M72.5 -112.2C105 -106.8 149.9 -109.6 171.2 -92.3C192.6 -75 190.3 -37.5 186.7 -2.1C183.1 33.3 178.1 66.7 161.2 91.6C144.3 116.6 115.4 133.2 86.5 153.4C57.7 173.5 28.8 197.3 5 188.5C-18.8 179.8 -37.5 138.6 -59 114.2C-80.5 89.8 -104.8 82.1 -120.1 65.9C-135.4 49.7 -141.7 24.8 -143.8 -1.2C-146 -27.3 -144 -54.7 -131.7 -76C-119.4 -97.4 -96.7 -112.8 -73 -123.3C-49.3 -133.8 -24.7 -139.4 -2.3 -135.3C20 -131.3 40 -117.6 72.5 -112.2",fill:"#f17c53"})})]})})};class yt{constructor(e=null){e===null&&(e={scaleX:1,scaleY:1,width:window.innerWidth,height:window.innerHeight,x:0,y:0});const[n,s]=_(e);this._config=n,this.setConfig=s}get config(){return this._config.current}get scale(){return this.config.scaleX}get pos(){return[this.config.x,this.config.y]}get dims(){return[this.config.width,this.config.height]}addConfig(e){this.setConfig(g(g({},this.config),e))}setDims([e,n]){this.setConfig(y(g({},this.config),{width:e,height:n}))}setPos([e,n]){this.setConfig(y(g({},this.config),{x:e,y:n}))}setScale(e){this.setConfig(y(g({},this.config),{scaleX:e,scaleY:e}))}}const re=E.createContext(),xt=({value:t,children:e})=>c(re.Provider,{value:t,children:e}),vt=()=>h.exports.useContext(re),wt=()=>{const[t,e]=_(!1),n=h.exports.useRef(),s=R.utils.selector(n),r=h.exports.useRef(),{link:o}=L(),i=q(),l=vt(),a=async u=>{if(u.key==="Enter"){const m=u.target.value,d=await P(m);if(o.con.anim(!1),u.target.value="",u.target.blur(),!d)return;const p=await D(d,l.config);p&&i.addMedia(p)}};return h.exports.useLayoutEffect(()=>{const u=R.timeline({paused:!0}),m={ease:"Expo.easeOut",scaleX:0,zIndex:0,delay:.2},d={duration:.25,zIndex:0,opacity:0},p={scaleY:0,opacity:0};u.from(n.current,d),u.from(s(".linkInput"),m),u.from(s(".linkText"),p),o.con.input=u,o.con.anim=(v=null)=>{const C=v===null?!t.current:v;return e(C),o.con.callback(C),C?(o.con.svgTl.play(),o.con.input.play(),C):(o.con.input.reverse(),o.con.svgTl.reverse(),C)};const x=v=>{const C=v.type==="keydown"&&v.key==="Escape",b=!v.target.closest(".innerParts, input")&&!u.paused()&&!!u.totalProgress();(C||b)&&o.con.anim(!1)},k=(v=!1)=>{"click tap keydown".split(" ").forEach(C=>{window[v?"removeEventListener":"addEventListener"](C,b=>x(b))})};return k(),()=>k(!0)},[]),w("div",{className:"linkField",ref:n,children:[c("div",{className:"linkText",children:"Enter a link here:"}),c("input",{ref:r,type:"text",name:"linkInput",className:"linkInput",onKeyDown:a}),c(mt,{controller:o})]})},Ct=()=>{const t=[["Stage Background Color","color","stageBg"],["Show Guides","checkbox","showGuides"]],[e,n]=h.exports.useState(!1),s=h.exports.useRef(),r=W(),o=L(),i=[l=>{r.reset()},l=>{r.setStageBg(Ee(l.target.value))},l=>{r.setShowGuides(l.target.checked)}];return h.exports.useLayoutEffect(()=>{const l=R.timeline({paused:!0}),a={ease:"Expo.easeOut",duration:1,width:0};l.from(s.current,a),o.con._tl=l,o.con.anim=(d=null)=>{const p=d===null?!e:d;if(n(p),p){o.con._tl.play();return}o.con._tl.reverse()};const u=d=>{const p=d.type==="keydown"&&d.key==="Escape",x=!d.target.closest(".settingsMenu")&&!l.paused()&&!!l.totalProgress();(p||x)&&o.con.anim(!1)},m=(d=!1)=>{"click tap keydown".split(" ").forEach(p=>{window[d?"removeEventListener":"addEventListener"](p,x=>u(x))})};return m(),()=>m(!1)},[]),c("div",{className:"mainWrapper",ref:s,children:c("div",{className:"settingsMenu",children:c("div",{className:"innerMenu",children:w("table",{width:"100%",children:[t.map(([l,a,u],m)=>c("tbody",{children:w("tr",{children:[c("td",{children:c("label",{htmlFor:`input${m}`,children:l})}),c("td",{children:w("div",{children:[c("input",{checked:a==="checkbox"?r[u]:!1,id:`input${m}`,type:a,onChange:d=>i[m+1](d)}),a==="color"&&c("div",{className:"colorSwatch"}),c("span",{})]})})]})},m)),c("tfoot",{children:c("tr",{children:c("td",{colSpan:"2",children:c("input",{type:"submit",value:"Reset Settings",onClick:i[0]})})})})]})})})})},Rt=({guides:t})=>t.map((e,n)=>c(j,y(g({},e),{offset:{x:e.offset,y:e.offset}}),n)),F=(t,e,n)=>{const s=t.current;s.setAttrs({visible:e.current.visible,x:Math.min(e.current.x1,e.current.x2)-n.x,y:Math.min(e.current.y1,e.current.y2)-n.y,width:Math.abs(e.current.x1-e.current.x2),height:Math.abs(e.current.y1-e.current.y2),fill:"rgba(0, 161, 255, 0.3)"}),s.getLayer().batchDraw()},St=(t,e)=>{t.target===t.target.getStage()&&(e.selectShape(null),e.trRef.nodes([]),e.setNodes([]))},kt=(t,e)=>{const n=t.target.hasName("image"),s=t.target.findAncestor("Transformer");if(n||s)return;const r=e.stageRef.position();let o=t.target.getStage().getRelativePointerPosition();o={x:o.x+r.x,y:o.y+r.y},e._curSelection.current.visible=!0,e._curSelection.current.x1=o.x,e._curSelection.current.y1=o.y,e._curSelection.current.x2=o.x,e._curSelection.current.y2=o.y,F(e._selectionRectRef,e._curSelection,r)},bt=(t,e)=>{if(!e.curSelection.visible)return;const n=e.stageRef.position();let s=t.target.getStage().getRelativePointerPosition();s={x:s.x+n.x,y:s.y+n.y},e.curSelection.x2=s.x,e.curSelection.y2=s.y,F(e._selectionRectRef,e._curSelection,n)},Mt=t=>{if(!t.curSelection.visible)return;const e=t.selectionRectRef.getClientRect(),n=[];t.layerRef.find(".image").forEach(s=>{const r=s.getClientRect();Konva.Util.haveIntersection(e,r)&&n.push(s)}),t.trRef.nodes(n),t.setNodes(t.trRef.nodes()),t._curSelection.current.visible=!1,Konva.listenClickTap=!1,F(t._selectionRectRef,t._curSelection,t.stageRef.position())},_t=(t,e)=>{let n=t.target.getStage(),s=e.layerRef,r=e.trRef;if(t.target===n){e.selectShape(null),e.setNodes([]),r.nodes([]),s.draw();return}if(!t.target.hasName("image"))return;const o=t.evt.shiftKey||t.evt.ctrlKey||t.evt.metaKey,i=r.nodes().indexOf(t.target)>=0;if(!o&&!i)r.nodes([t.target]);else if(o&&i){const l=r.nodes().slice();l.splice(l.indexOf(t.target),1),r.nodes(l)}else if(o&&!i){const l=r.nodes().concat([t.target]);r.nodes(l)}e.setNodes(r.nodes()),s.draw()},Et=async(t,e,n,s,r)=>{let o;const i=t.dataTransfer.files,l=t.dataTransfer.getHTML(),a=t.dataTransfer.getText();if(i.length)try{const d=await te(i,s,r);n([...e,...d]);return}catch(d){console.trace(d)}const u=et(l);if(u?o=await P(u):o=await P(a),!o)return;const m=await D(o,s,r);n([...e,m])},oe=10,Lt=(t,e)=>{let n=[0,e.current.width()/2,e.current.width()],s=[0,e.current.height()/2,e.current.height()];return e.current.find(".image").forEach(r=>{if(r===t)return;let o=r.getClientRect();n.push([o.x,o.x+o.width,o.x+o.width/2]),s.push([o.y,o.y+o.height,o.y+o.height/2])}),{vertical:n.flat(),horizontal:s.flat()}},Dt=t=>{let e=t.getClientRect(),n=t.absolutePosition();return{vertical:[{guide:Math.round(e.x),offset:Math.round(n.x-e.x),snap:"start"},{guide:Math.round(e.x+e.width/2),offset:Math.round(n.x-e.x-e.width/2),snap:"center"},{guide:Math.round(e.x+e.width),offset:Math.round(n.x-e.x-e.width),snap:"end"}],horizontal:[{guide:Math.round(e.y),offset:Math.round(n.y-e.y),snap:"start"},{guide:Math.round(e.y+e.height/2),offset:Math.round(n.y-e.y-e.height/2),snap:"center"},{guide:Math.round(e.y+e.height),offset:Math.round(n.y-e.y-e.height),snap:"end"}]}},Nt=(t,e)=>{let n=[],s=[];t.vertical.forEach(l=>{e.vertical.forEach(a=>{let u=Math.abs(l-a.guide);u<oe&&n.push({lineGuide:l,diff:u,snap:a.snap,offset:a.offset})})}),t.horizontal.forEach(l=>{e.horizontal.forEach(a=>{let u=Math.abs(l-a.guide);u<oe&&s.push({lineGuide:l,diff:u,snap:a.snap,offset:a.offset})})});let r=[],o=n.sort((l,a)=>l.diff-a.diff)[0],i=s.sort((l,a)=>l.diff-a.diff)[0];return o&&r.push({lineGuide:o.lineGuide,offset:o.offset,orientation:"V",snap:o.snap}),i&&r.push({lineGuide:i.lineGuide,offset:i.offset,orientation:"H",snap:i.snap}),r},Gt=(t,e,n)=>{const s=n?"rgb(0, 161, 255)":"rgba(0, 161, 255, 0)";t&&t.forEach(r=>{if(r.orientation==="H"){let o={points:[-6e3,0,6e3,0],stroke:s,strokeWidth:1,name:"guid-line",dash:[4,6],x:0,y:r.lineGuide};e([...t,o])}else if(r.orientation==="V"){let o={points:[0,-6e3,0,6e3],stroke:s,strokeWidth:1,name:"guid-line",dash:[4,6],x:r.lineGuide,y:0};e([...t,o])}})},It=(t,e,n,s)=>{let r=Lt(t.target,e),o=Dt(t.target),i=Nt(r,o);if(!i.length)return;Gt(i,n,s);let l=t.target.absolutePosition();i.forEach(a=>{switch(a.snap){case"start":{switch(a.orientation){case"V":{l.x=a.lineGuide+a.offset;break}case"H":{l.y=a.lineGuide+a.offset;break}}break}case"center":{switch(a.orientation){case"V":{l.x=a.lineGuide+a.offset;break}case"H":{l.y=a.lineGuide+a.offset;break}}break}case"end":{switch(a.orientation){case"V":{l.x=a.lineGuide+a.offset;break}case"H":{l.y=a.lineGuide+a.offset;break}}break}}}),t.target.absolutePosition(l)},Tt=(t,e)=>{e([])},Ot=(t,e,n)=>{t.evt.preventDefault();const s=t.target.getStage(),r=s.scaleX(),o={x:s.getRelativePointerPosition().x/r-s.x()/r,y:s.getRelativePointerPosition().y/r-s.y()/r};let i=t.evt.deltaY<0?r*e:r/e;i=Math.max(.02,i),n({scaleX:i,scaleY:i,x:(s.getRelativePointerPosition().x/i-o.x)*i,y:(s.getRelativePointerPosition().y/i-o.y)*i})},Pt=()=>{const t=new $e,e=new He,n=new je,s=new yt,r=new Ae,o=new Te,i=new Ue,l=new Ye,a=new G,[u,m]=_([]);return h.exports.useEffect(()=>{S(":root").css("--bg-img",`url(${Re})`),S(":root").css("--bg-settings.settings",`url(${Se})`);const d=se(n,o,r,s,e,l),p=f=>{o.setRotateFree(f.shiftKey),o.setScaleBy(f.shiftKey),f.type==="keydown"&&(["Delete","Backspace","x"].includes(f.key)&&d[11](),f.ctrlKey&&f.key==="i"&&d[1](),f.key==="q"&&!f.ctrlKey&&a.con.anim(),f.key==="i"&&!f.ctrlKey&&d[3](),f.key==="p"&&d[4](),f.key==="d"&&!f.ctrlKey&&d[5](),f.key==="g"&&d[6](),f.key==="t"&&d[7](),f.key==="r"&&d[8](),f.key==="m"&&d[9](),f.key==="p"&&d[4](f),f.ctrlKey&&f.key==="s"&&(f.preventDefault(),d[2]()),f.ctrlKey&&f.key==="d"&&(f.preventDefault(),d[10]()),f.ctrlKey&&f.key==="q"&&t.con.anim())},x=()=>{s.setConfig(y(g({},s.config),{width:window.innerWidth,height:window.innerHeight}))},k=f=>{i.con.anim(),f.preventDefault()},v=f=>{i.con.anim(!0)},C=f=>{f.dataTransfer.getText=()=>f.dataTransfer.getData("text"),f.dataTransfer.getHTML=()=>f.dataTransfer.getData("text/html"),i.con.anim(!0),f.preventDefault(),Et(f,n.media,n.setMedia,s.config,{x:(f.pageX-s.config.x)/s.config.scaleX,y:(f.pageY-s.config.y)/s.config.scaleY})},b=(f=!1)=>{window[f?"removeEventListener":"addEventListener"]("dragover",k),window[f?"removeEventListener":"addEventListener"]("dragleave",v),window[f?"removeEventListener":"addEventListener"]("drop",C),window[f?"removeEventListener":"addEventListener"]("resize",x),document[f?"removeEventListener":"addEventListener"]("keyup",p),document[f?"removeEventListener":"addEventListener"]("keydown",p)};return b(),()=>b(!0)},[]),h.exports.useEffect(()=>{De(e.settings),S(":root").css("--var-bg-color",e.settings.stageBg)},[e.settings]),c(Oe,{value:o,children:c(Ke,{value:e,children:c(Be,{value:r,children:c(Xe,{value:n,children:w(xt,{value:s,children:[c(O,{value:t,children:c(Ct,{})}),w(O,{value:{link:l,menu:a},children:[c(wt,{}),c(ft,{})]}),c(O,{value:i,children:c(pt,{})}),c(me,y(g({},s.config),{ref:r._stageRef,draggable:o.stageDrag,onDblClick:async d=>{t.con.anim()},onWheel:d=>Ot(d,o.scaleBy,p=>s.addConfig(p)),onDragEnd:()=>{!o.stageDrag||s.setConfig(g(g({},s.config),r.stageRef.position()))},onTouchStart:d=>{St(d,r)},onMouseDown:d=>{o.stageDrag||kt(d,r)},onMouseMove:d=>{o.stageDrag||bt(d,r)},onMouseUp:d=>{o.stageDrag||(s.setConfig(g(g({},s.config),r.stageRef.position())),Mt(r))},onClick:d=>{_t(d,r)},children:w(ye,{ref:r._layerRef,onDragMove:d=>{!o.isGuides||It(d,r._stageRef,m,e.showGuides)},onDragEnd:d=>{!o.isGuides||Tt(d,m)},children:[n.media.map((d,p)=>{const x={imageProps:d,isSelected:p===r.selectedId,onChange:k=>{const v=n.media.slice();v[p]=k,n.setMedia(v)},idx:p,key:p};return d.type==="img"?c(ke,g({},x)):c(_e,g({},x))}),o.isGuides&&c(Rt,{guides:u.current}),c(xe,{ref:r._trRef,boundBoxFunc:(d,p)=>p.width<5||p.height<5?d:p,rotateEnabled:o.isRot,resizeEnabled:o.isResize,borderStrokeWidth:r.nodesArray.length>1?.25:.1,rotationSnapTolerance:o.rotateFree?0:5,name:"transformer",borderStroke:"#00d0ff",anchorSize:7.5,anchorStrokeWidth:1,anchorStroke:"#b5b5b5",anchorCornerRadius:50,rotationSnaps:[0,45,90,135,180,-45,-90,-135,-180],rotateAnchorOffset:0}),c(ve,{fill:"rgba(0,0,255,0.5)",ref:r._selectionRectRef})]})}))]})})})})})};we.render(c(E.StrictMode,{children:c(Pt,{})}),document.getElementById("root"));
